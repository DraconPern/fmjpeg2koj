image: Visual Studio 2017

configuration:
  - Release

install:
  - SET TYPE=%CONFIGURATION%
  - SET DEVSPACE=%APPVEYOR_BUILD_FOLDER%
  - SET GENERATOR="Visual Studio 15 2017"
  
# dcmtk & zlib
  - cd %DEVSPACE%
  - git clone --branch=DCMTK-3.6.5 --single-branch --depth 1 https://github.com/DCMTK/dcmtk.git

# openjpeg
  - cd %DEVSPACE%
  - git clone --branch=v2.4.0 --single-branch --depth 1 https://github.com/uclouvain/openjpeg.git

build_script:
  - cd %DEVSPACE%
  - build.bat

after_build:
  - cd %DEVSPACE%
  - 7z a fmjpeg2koj-win.7z fmjpeg2koj\%TYPE% openjpeg\%TYPE%
  - mv fmjpeg2koj-win.7z %APPVEYOR_BUILD_FOLDER%

artifacts:
  - path: fmjpeg2koj-win.7z
    name: fmjpeg2koj-win
 
deploy:
  provider: S3
  access_key_id:
    secure: NoQGGjuA1OWCnB7LiTCQDw19+jVRaveK8QbFY+FSVEg=
  secret_access_key:
    secure: quY6Ltwn2DiEWqh48ZIFIqx50TduHHKbcRrunpiEzcRZIIsUohb5Y5viJ/TkPzUj
  bucket: draconpern-buildcache
  set_public: true
  folder: 
  artifact: fmjpeg2koj-win
 